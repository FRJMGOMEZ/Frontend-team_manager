(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{Abus:function(t,e,c){"use strict";c.r(e),c.d(e,"CalendarSchedulerMonthModule",(function(){return E}));var a=c("ofXK"),n=c("lJxs");class i{constructor(t){this.tasks=[],this.date=t.getTime()}}var s=c("Brg/"),o=c("fXoL"),r=c("S6We"),l=c("qmzK"),d=c("tyNb"),h=c("FLjf"),g=c("SV+Y"),u=c("XiUz"),m=c("Wp6s"),p=c("znSr"),k=c("NFeN"),f=c("STbY"),y=c("Qu3c");function w(t,e){if(1&t&&(o.hc(0,"mat-card",3),o.hc(1,"span",4),o.Qc(2),o.gc(),o.hc(3,"p",5),o.Qc(4),o.gc(),o.gc()),2&t){const t=e.$implicit;o.Ob(2),o.Sc(" ",t," "),o.Ob(2),o.Sc(" ",t.charAt(0)," ")}}function T(t,e){if(1&t){const t=o.ic();o.fc(0),o.hc(1,"mat-icon",15),o.Qc(2," trip_origin"),o.gc(),o.hc(3,"mat-menu",null,16),o.hc(5,"button",17),o.pc("click",(function(){o.Hc(t);const c=e.$implicit;return o.tc(5).checkTask.emit(c._id)})),o.Qc(6,"View details"),o.gc(),o.hc(7,"div"),o.hc(8,"button",18),o.pc("click",(function(){o.Hc(t);const c=e.$implicit;return o.tc(5).putTask.emit(c._id)})),o.Qc(9,"Edit"),o.gc(),o.gc(),o.hc(10,"div"),o.hc(11,"button",18),o.pc("click",(function(){o.Hc(t);const c=e.$implicit;return o.tc(5).deleteTask.emit(c._id)})),o.Qc(12,"Delete"),o.gc(),o.gc(),o.gc(),o.ec()}if(2&t){const t=e.$implicit,c=o.Fc(4),a=o.tc(5);o.Ob(1),o.Qb(1===t.priority?"priority-low":2===t.priority?"priority-medium":"priority-high"),o.zc("matMenuTriggerFor",c)("matTooltip",a.eventTooltip(t))("matTooltipClass","event-tooltip")("color",a.iconColor(t)),o.Ob(7),o.zc("disabled",a.taskService.taskTimeEnded(t)),o.Ob(3),o.zc("disabled",a.taskService.taskTimeEnded(t))}}function b(t,e){if(1&t){const t=o.ic();o.hc(0,"mat-icon",19),o.pc("click",(function(){o.Hc(t);const e=o.tc().aVariable;return o.tc(4).checkTasks.emit(e.date)})),o.Qc(1,"pageview"),o.gc()}}const D=function(t){return{"day-unactive":t}};function v(t,e){if(1&t&&(o.hc(0,"div"),o.hc(1,"div"),o.hc(2,"p",11),o.Qc(3),o.uc(4,"date"),o.gc(),o.gc(),o.hc(5,"div",12),o.Oc(6,T,13,8,"ng-container",13),o.gc(),o.hc(7,"p",5),o.Oc(8,b,2,0,"mat-icon",14),o.gc(),o.gc()),2&t){const t=e.aVariable,c=o.tc(4);o.Ob(2),o.zc("ngClass",o.Bc(7,D,c.checkDayActive(t.date))),o.Ob(1),o.Rc(o.wc(4,4,t.date,"d")),o.Ob(3),o.zc("ngForOf",t.tasks),o.Ob(2),o.zc("ngIf",t.tasks.length>0)}}const O=function(t){return{height:t}},S=function(t){return{aVariable:t}};function x(t,e){if(1&t&&(o.hc(0,"div",3),o.hc(1,"mat-card"),o.hc(2,"mat-card-content",8),o.Oc(3,v,9,9,"ng-template",9,10,o.Pc),o.gc(),o.gc(),o.gc()),2&t){const t=e.index,c=o.Fc(4),a=o.tc().$implicit,n=o.tc(2);o.Ob(2),o.zc("ngStyle",o.Bc(3,O,n.cellSize)),o.Ob(1),o.zc("ngTemplateOutletContext",o.Bc(5,S,n.getDayOfWeek(a,t)))("ngTemplateOutlet",c)}}function M(t,e){if(1&t&&(o.hc(0,"div",0),o.Oc(1,x,5,7,"div",1),o.gc()),2&t){const t=o.tc(2);o.Ob(1),o.zc("ngForOf",t.labels)}}function F(t,e){if(1&t&&(o.hc(0,"div",6),o.Oc(1,M,2,1,"div",7),o.gc()),2&t){const t=o.tc();o.Ob(1),o.zc("ngForOf",t.dayRows)}}let C=(()=>{class t{constructor(t,e,c){this.taskService=t,this.locale=e,this.mdService=c,this.labels=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],this.checkTask=new o.r,this.putTask=new o.r,this.checkTasks=new o.r,this.deleteTask=new o.r}getDayOfWeek(t,e){let c=t.filter(t=>new Date(t.date).getDay()===e)[0];if(c&&new Date(c.date))return c}checkDayActive(t){let e=new Date;return new Date(t).getTime()<new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0).getTime()}get cellSize(){if(this.dayRows){const t=this.dayRows.flat();return this.mdService.desktop?t.length>35?"9.5vh":"12vh":t.length>35?"7.2vh":"9vh"}return"10vh"}iconColor(t){let e=new Date,c=h.a;return t.endDate>e.getTime()?t.endDate>e.getTime()+c?"primary":"accent":"warn"}eventTooltip(t){return`${t.name} \n START:${Object(a.I)(new Date(t.startDate),"M/d/yy, h:mm a",this.locale)} \n END:${Object(a.I)(new Date(t.endDate),"M/d/yy, h:mm a",this.locale)} `}}return t.\u0275fac=function(e){return new(e||t)(o.bc(r.a),o.bc(o.D),o.bc(g.a))},t.\u0275cmp=o.Vb({type:t,selectors:[["app-calendar-scheduler-month"]],inputs:{selectedDate:"selectedDate",dayRows:"dayRows",selectedProject:"selectedProject"},outputs:{checkTask:"checkTask",putTask:"putTask",checkTasks:"checkTasks",deleteTask:"deleteTask"},decls:4,vars:4,consts:[["fxLayout","row"],["fxFlex","14",4,"ngFor","ngForOf"],["fxLayout","column",4,"ngIf"],["fxFlex","14"],["fxLayoutAlign","center","fxHide.lt-md",""],["fxLayoutAlign","center","fxHide.gt-sm","","fxShow.lt-md",""],["fxLayout","column"],["fxLayout","row",4,"ngFor","ngForOf"],["fxLayout","column",3,"ngStyle"],[3,"ngTemplateOutletContext","ngTemplateOutlet"],["selfie",""],[1,"day",3,"ngClass"],["fxShow.gt-sm","","fxHide.lt-md","",1,"div-tasks"],[4,"ngFor","ngForOf"],["color","primary",3,"click",4,"ngIf"],[3,"matMenuTriggerFor","matTooltip","matTooltipClass","color"],["menuPc","matMenu"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"disabled","click"],["color","primary",3,"click"]],template:function(t,e){1&t&&(o.hc(0,"div"),o.hc(1,"div",0),o.Oc(2,w,5,2,"mat-card",1),o.gc(),o.Oc(3,F,2,1,"div",2),o.gc()),2&t&&(o.Nc("margin","10px"),o.Ob(2),o.zc("ngForOf",e.labels),o.Ob(1),o.zc("ngIf",e.dayRows))},directives:[u.f,a.s,a.t,m.a,u.b,u.e,p.c,m.d,a.w,p.d,a.A,a.q,p.a,k.a,f.d,y.a,f.e,f.b],pipes:[a.f],styles:["mat-card[_ngcontent-%COMP%]{padding:5px!important}.day-unactive[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed!important}.day[_ngcontent-%COMP%]{margin-bottom:0}.day[_ngcontent-%COMP%], .task[_ngcontent-%COMP%]{cursor:pointer}.task[_ngcontent-%COMP%]{font-size:13px;height:13px;margin:0;padding:0}.div-tasks[_ngcontent-%COMP%]{overflow-y:auto}.priority-high[_ngcontent-%COMP%]{font-size:25px}.priority-medium[_ngcontent-%COMP%]{font-size:20px}.priority-low[_ngcontent-%COMP%]{font-size:15px}  .mat-tooltip{white-space:pre-line}"],changeDetection:0}),t})(),R=(()=>{class t{constructor(t,e,c,a){this.taskService=t,this.dialogsService=e,this.cdr=c,this.ar=a,this.selectedDate=new Date}ngOnInit(){this.ar.queryParamMap.subscribe(t=>{this.selectedDate=new Date(t.get("selectedDate")),this.selectedProject=t.get("selectedProject"),this.setRangeAndDays().then(()=>{this.getTasks()})}),this.taskSubscription=this.taskService.task$.subscribe(t=>{switch(t.action){case"POST":this.insertTask(t.task);break;case"PUT":this.removeTask(t.task),this.insertTask(t.task);break;case"DELETE":this.removeTask(t.task)}this.dayRows=[...this.dayRows],this.cdr.markForCheck()})}insertTask(t){this.dayRows.forEach((e,c)=>{e.forEach((e,a)=>{let n=t.project,i=new Date(t.startDate);i=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),e.date>=i.getTime()&&e.date<=t.endDate&&n===this.selectedProject&&(this.dayRows[c][a].tasks=[...e.tasks,t])})})}removeTask(t){this.dayRows=[...this.dayRows.map(e=>e.map(e=>(e.tasks=e.tasks.filter(e=>e._id!=t._id),e)))]}getTasks(){this.taskService.getTasks("month",s.d.toQueryString({project:this.selectedProject,from:this.timeRange[0],to:this.timeRange[1]})).pipe(Object(n.a)(t=>t.tasks)).subscribe(t=>{t.forEach(t=>{this.insertTask(t)}),this.cdr.detectChanges()})}setRangeAndDays(){return new Promise((t,e)=>{return c=this,void 0,n=function*(){let e=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth()+1,0).getDate(),c=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),e,0,0,0,0),a=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),1,0,0,0,0);this.days=yield this.getCalendarDays(this.selectedDate,e,c,a),this.dayRows=s.a.divideArray(this.days,7),this.timeRange=yield this.getTimeRange(this.selectedDate,e,c,a),t("")},new((a=void 0)||(a=Promise))((function(t,e){function i(t){try{o(n.next(t))}catch(c){e(c)}}function s(t){try{o(n.throw(t))}catch(c){e(c)}}function o(e){var c;e.done?t(e.value):(c=e.value,c instanceof a?c:new a((function(t){t(c)}))).then(i,s)}o((n=n.apply(c,[])).next())}));var c,a,n})}getCalendarDays(t,e,c,a){let n=[];for(let s=1-a.getDay();s<=e+(6-c.getDay());s++)n.push(new i(new Date(t.getFullYear(),t.getMonth(),s,0,0,0,0)));return n}getTimeRange(t,e,c,a){return[new Date(t.getFullYear(),t.getMonth(),1-a.getDay()).getTime(),new Date(t.getFullYear(),t.getMonth(),e+(6-c.getDay()),23,59,59,0).getTime()]}ngOnDestroy(){this.taskSubscription&&this.taskSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(o.bc(r.a),o.bc(l.a),o.bc(o.i),o.bc(d.a))},t.\u0275cmp=o.Vb({type:t,selectors:[["app-calendar-scheduler-month-smart"]],decls:1,vars:2,consts:[[3,"dayRows","selectedDate","checkTask","putTask","deleteTask","checkTasks"]],template:function(t,e){1&t&&(o.hc(0,"app-calendar-scheduler-month",0),o.pc("checkTask",(function(t){return e.dialogsService.openTaskInfoDialog(t)}))("putTask",(function(t){return e.dialogsService.openEditCreateTaskDialog(t)}))("deleteTask",(function(t){return e.taskService.deleteTask(t).subscribe()}))("checkTasks",(function(t){return e.dialogsService.openTasksListInfoDialog(t)})),o.gc()),2&t&&o.zc("dayRows",e.dayRows)("selectedDate",e.selectedDate)},directives:[C],encapsulation:2,changeDetection:0}),t})();var P=c("YUcS"),z=c("jAig"),_=c("zAIM"),j=c("+Mmm"),A=c("tb/P");let Y=[{path:"",component:R}],E=(()=>{class t{}return t.\u0275mod=o.Zb({type:t}),t.\u0275inj=o.Yb({factory:function(e){return new(e||t)},imports:[[a.c,d.g.forChild(Y),z.a,P.a,_.a,j.a,A.a]]}),t})()}}]);